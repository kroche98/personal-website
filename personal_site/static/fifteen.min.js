const TILE_WIDTH=50;function shuffle(e){const t=[];for(;e.length;)randomIndex=Math.floor(Math.random()*e.length),t.push(e[randomIndex]),e.splice(randomIndex,1);return t}class Puzzle{constructor(e){this.size=e,this.board=[...Array(e*e).keys()],this.blank_val=e*e-1}_x(e){return e%this.size}_y(e){return Math.floor(e/this.size)}_i(e,t){return this.size*t+e}_blank_i(){return this.board.indexOf(this.blank_val)}randomize(){do{this.board=shuffle(this.board)}while(!this.solvable())}solvable(){return this.size%2==1&&this.inversions()%2==0||this.size%2==0&&this._y(this._blank_i())%2==1==(this.inversions()%2==0)}inversions(){return this.board.map(((e,t,s)=>e===this.size*this.size-1?0:s.filter(((s,i)=>i>t&&s<e)).length)).reduce(((e,t)=>e+t),0)}slide(e){let t=this._x(e),s=this._y(e),i=this._blank_i(),l=this._x(i),o=this._y(i);if(t===l&&s===o)return!1;if(t===l){let t=i;if(i>e)for(;t>e;)this._swap(t,t-this.size),t-=this.size;else if(i<e)for(;t<e;)this._swap(t,t+this.size),t+=this.size}else{if(s!==o)return!1;{let t=i;if(i>e)for(;t>e;)this._swap(t,t-1),t-=1;else if(i<e)for(;t<e;)this._swap(t,t+1),t+=1}}return!0}solved(){const e=[...Array(this.size*this.size).keys()];return this.board.every(((t,s)=>t===e[s]))}_swap(e,t){[this.board[e],this.board[t]]=[this.board[t],this.board[e]]}}class PuzzleDisplay{constructor(e,t,s,i){for(this.puzzle=e,this.tileWidth=s,this.styleSpecifier=i;t.firstChild;)t.removeChild(t.firstChild);const l=document.createElement("div");l.id="puzzle-frame",l.style.width=this.tileWidth*e.size+"px",l.style.height=this.tileWidth*e.size+"px",t.appendChild(l),this.squares=[];for(let t of e.board){let e=document.createElement("div");e.style.order=t,e.style.height=100/this.puzzle.size+"%",e.style.width=100/this.puzzle.size+"%",e.onclick=()=>this.move(e);let s=document.createElement("div");this.squares[t]=e,e.append(s),l.appendChild(e)}this.decorate()}decorate(){for(let e=0;e<this.squares.length;e++){this.puzzle.board[e];let t=this.squares[e].firstChild;t.className="",t.style.cssText="",t.textContent="",e===this.puzzle.blank_val?t.className="square blank-tile":this.styleSpecifier(e,t,this.tileWidth,this.puzzle),t.style.height="100%",t.style.width="100%"}}changeStyle(e){this.styleSpecifier=e,this.decorate()}move(e){this.puzzle.slide(e.style.order)&&(this.updateDisplay(),this.puzzle.solved()&&setTimeout((()=>alert("Congratulations! You solved the puzzle.")),10))}updateDisplay(){for(let e of this.puzzle.board.keys()){let t=this.puzzle.board[e];this.squares[t].style.order=e}}randomize(){this.puzzle.randomize(),this.updateDisplay()}}function redWhiteStyle(e,t,s,i){i.size%2==0?t.className=(e+i._y(e))%2==0?"square red-tile":"square white-tile":t.className=e%2==0?"square red-tile":"square white-tile",t.textContent=e+1}function woodStyle(e,t,s,i){t.className="square wood-tile",t.style.backgroundSize=s*i.size+"px "+s*i.size+"px",t.style.backgroundPositionX=i._x(e)*-s+"px",t.style.backgroundPositionY=i._y(e)*-s+"px",t.textContent=e+1}function grayStyle(e,t,s,i){t.className="square gray-tile",t.textContent=e+1}function imageStyle(e,t,s,i){t.className="square image-tile",t.style.backgroundSize=s*i.size+"px "+s*i.size+"px",t.style.backgroundPositionX=i._x(e)*-s+"px",t.style.backgroundPositionY=i._y(e)*-s+"px",t.textContent=e+1}const styleLookup=new Map;function changeSize(e){const t=puzzleDisplay.styleSpecifier;puzzle=new Puzzle(e),puzzleDisplay=new PuzzleDisplay(puzzle,document.getElementById("puzzle-container"),TILE_WIDTH,t);for(let t=2;t<=8;t++)t===e?document.getElementById(`size-${t}`).classList.add("current-selection"):document.getElementById(`size-${t}`).classList.remove("current-selection")}function changeStyle(e){let t=styleLookup.get(e);puzzleDisplay.changeStyle(t);for(let t of styleLookup.keys())t===e?(puzzleDisplay.changeStyle(styleLookup.get(t)),document.getElementById(`${t}-style`).classList.add("current-selection")):document.getElementById(`${t}-style`).classList.remove("current-selection")}styleLookup.set("red-white",redWhiteStyle),styleLookup.set("wood",woodStyle),styleLookup.set("gray",grayStyle),styleLookup.set("image",imageStyle);let puzzle=new Puzzle(4),puzzleDisplay=new PuzzleDisplay(puzzle,document.getElementById("puzzle-container"),TILE_WIDTH,redWhiteStyle);document.getElementById("size-4").classList.add("current-selection"),document.getElementById("red-white-style").classList.add("current-selection");
